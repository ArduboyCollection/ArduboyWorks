#include "common.h"

/*  Defines  */

/*  Local Functions  */

/*  Local Variables  */

PROGMEM static const uint8_t imgTitle1[] = { // "Hollow" 84x20
    0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xFE, 0xFE, 0xFE, 0xFE,
    0xFE, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x80, 0x00,
    0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x80, 0x00, 0x00, 0xC0, 0xC0,
    0xC0, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x00, 0x00, 0xC0,
    0xC0, 0xC0, 0xC0, 0xC0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x7C, 0xFF, 0xFF, 0xFF, 0xFF, 0xC7, 0x83, 0x83, 0xC7,
    0xFF, 0xFF, 0xFF, 0xFF, 0x7C, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x00, 0x00, 0x7C, 0xFF, 0xFF, 0xFF, 0xFF, 0xC7, 0x83, 0x83, 0xC7, 0xFF, 0xFF, 0xFF,
    0xFF, 0x7C, 0x00, 0x0F, 0x7F, 0xFF, 0xFF, 0xFF, 0xF0, 0xF0, 0xFF, 0xFF, 0x1F, 0x1F, 0xFF, 0xFF,
    0xFF, 0xF0, 0xF0, 0xFF, 0xFF, 0x7F, 0x07, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x07,
    0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x03, 0x01, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00,
    0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x07, 0x07, 0x07, 0x07,
    0x07, 0x07, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03,
    0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x00, 0x00, 0x00,
};

PROGMEM static const uint8_t imgTitle2[] = { // "Seeker" 80x20
    0xF0, 0xF8, 0xFC, 0xFE, 0xFE, 0x9E, 0x1E, 0x1E, 0x1E, 0x1E, 0x3C, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x80, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80,
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,
    0x00, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x80, 0x80, 0xC0, 0xC0, 0xC0, 0xC0,
    0xC0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0xC0, 0xC0, 0xC0, 0x00,
    0xE1, 0xC3, 0xC7, 0x87, 0x8F, 0x8F, 0x9F, 0xFF, 0xFE, 0xFE, 0xFC, 0xF8, 0x00, 0x00, 0x7C, 0xFF,
    0xFF, 0xFF, 0xFF, 0xBB, 0x39, 0x39, 0x3F, 0x3F, 0x3F, 0xBF, 0x3E, 0x00, 0x7C, 0xFF, 0xFF, 0xFF,
    0xFF, 0xBB, 0x39, 0x39, 0x3F, 0x3F, 0x3F, 0xBF, 0x3E, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x18,
    0x7E, 0xFF, 0xFF, 0xFF, 0xFF, 0xE7, 0x83, 0x00, 0x7C, 0xFF, 0xFF, 0xFF, 0xFF, 0xBB, 0x39, 0x39,
    0x3F, 0x3F, 0x3F, 0xBF, 0x3E, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x07, 0x03, 0x03, 0x03, 0x00,
    0x03, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x01,
    0x03, 0x03, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03,
    0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00,
    0x00, 0x01, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x04, 0x01, 0x03, 0x03, 0x07, 0x07, 0x07, 0x07,
    0x07, 0x07, 0x07, 0x03, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
};

PROGMEM static const char menuGame[] = "START GAME";
PROGMEM static const char menuSound[] = "SOUND ";
PROGMEM static const char menuCredit[] = "CREDIT";

PROGMEM static const char * const menusTable[] = {
    menuGame, menuSound, menuCredit
};

PROGMEM static const char credit0[] = "- HOLLOW SEEKER -";
PROGMEM static const char credit1[] = "NOVEMBER 2016";
PROGMEM static const char credit2[] = "PROGREMMED BY OBONO";
PROGMEM static const char credit3[] = "THIS PROGRAM IS";
PROGMEM static const char credit4[] = "RELEASED UNDER";
PROGMEM static const char credit5[] = "MIT LICENSE.";

PROGMEM static const char * const creditsTable[] = {
    credit0, NULL, credit1, credit2, NULL, credit3, credit4, credit5
};

static bool     isCredit;
static bool     toDraw;
static bool     sound;
static int8_t   menuPos;

void initTitle()
{
    isCredit = false;
    toDraw = true;
    sound = false;
    menuPos = 0;
}

bool updateTitle()
{
    bool ret = false;
    if (!isCredit) {
        if (arduboy.buttonDown(UP_BUTTON)) {
            if (menuPos-- == 0) menuPos = 2;
            toDraw = true;
        }
        if (arduboy.buttonDown(DOWN_BUTTON)) {
            if (menuPos++ == 2) menuPos = 0;
            toDraw = true;
        }
        if (arduboy.buttonDown(B_BUTTON)) {
            switch (menuPos) {
            case 0:
                ret = true;
                break;
            case 1:
                sound = !sound;
                break;
            case 2:
                isCredit = true;
                break;
            }
            toDraw = true;
        }
    } else {
        if (arduboy.buttonDown(B_BUTTON)) {
            isCredit = false;
            toDraw = true;
        }
    }
    return ret;
}

void drawTitle()
{
    if (toDraw) {
        char buf[22], *p;
        arduboy.clear();
        if (!isCredit) {
            arduboy.drawBitmap(3, 0, imgTitle1, 84, 20, WHITE);
            arduboy.drawBitmap(45, 19, imgTitle2, 80, 20, WHITE);
            for (int i = 0; i < 3; i++) {
                p = pgm_read_word(menusTable + i);
                strcpy_P(buf, p);
                arduboy.setCursor(64 - (i == menuPos) * 2, i * 8 + 42);
                arduboy.print(buf);
                if (p == menuSound) {
                    arduboy.print((sound) ? F("ON") : F("OFF"));
                }
            }
            arduboy.fillRect2(54, menuPos * 8 + 42, 5, 5, WHITE);
        } else {
            for (int i = 0; i < 8; i++) {
                p = pgm_read_word(creditsTable + i);
                if (p != NULL) {
                    strcpy_P(buf, p);
                    uint8_t len = strnlen(buf, sizeof(buf));
                    arduboy.setCursor(64 - len * 3, i * 6 + 8);
                    arduboy.print(buf);
                }
            }
        }
    }
}

